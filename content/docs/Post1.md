---
title: Управление ограничениями AppArmor на непривилегированные пространства имён пользователей
type: docs
---

В некоторых ситуациях необходимо настроить параметры ядра для управления поведением системы и повышения её безопасности. Одним из таких параметров является `kernel.apparmor_restrict_unprivileged_userns`, который влияет на работу механизма AppArmor с непривилегированными пространствами имён пользователей. В этой статье мы рассмотрим, как изменить значение этого параметра с помощью команды `sysctl`, а также обсудим, на каких операционных системах это применимо.

## Что такое `kernel.apparmor_restrict_unprivileged_userns`?

Параметр `kernel.apparmor_restrict_unprivileged_userns` используется для управления ограничениями, накладываемыми AppArmor на непривилегированные пространства имён пользователей (user namespaces). Значение `0` означает, что ограничения не применяются, что может быть необходимо для некоторых приложений или системных конфигураций. Однако стоит учитывать, что это может снизить уровень безопасности системы.

## Изменение параметра с помощью `sysctl`

Для временного изменения значения параметра `kernel.apparmor_restrict_unprivileged_userns` можно использовать команду `sysctl`. Эта команда позволяет изменять параметры ядра в реальном времени без необходимости перезагружать систему.

### Пример использования

Чтобы установить значение `0` для параметра `kernel.apparmor_restrict_unprivileged_userns`, выполните следующую команду:

```bash
sudo sysctl -w kernel.apparmor_restrict_unprivileged_userns=0
```

Здесь:
- `sudo` — используется для выполнения команды с привилегиями суперпользователя.
- `sysctl` — команда для изменения параметров ядра.
- `-w` — ключ для задания нового значения.
- `kernel.apparmor_restrict_unprivileged_userns=0` — указывает, что параметр должен быть установлен в `0`.

### Проверка текущего значения

Чтобы проверить текущее значение параметра, выполните следующую команду:

```bash
sysctl kernel.apparmor_restrict_unprivileged_userns
```

Команда выведет текущее значение параметра. Если оно равно `0`, значит ограничения сняты.

## Постоянное изменение параметра

Для того чтобы изменения сохранялись после перезагрузки системы, необходимо добавить соответствующую строку в файл `/etc/sysctl.conf` или создать отдельный конфигурационный файл в каталоге `/etc/sysctl.d/`. Например, создадим файл `/etc/sysctl.d/99-disable-apparmor-restrict-unprivileged-userns.conf` с содержимым:

```
kernel.apparmor_restrict_unprivileged_userns=0
```

После этого примените изменения:

```bash
sudo sysctl -p /etc/sysctl.d/99-disable-apparmor-restrict-unprivileged-userns.conf
```

## Применимость на различных операционных системах

Параметр `kernel.apparmor_restrict_unprivileged_userns` доступен в операционных системах, где используется AppArmor и поддерживаются пространства имён пользователей. К ним относятся:

1. **Ubuntu** — начиная с версий, где включена поддержка AppArmor по умолчанию.
2. **Debian** — при использовании AppArmor.
3. **openSUSE** — поддерживает AppArmor и может использовать данный параметр.
4. **Kali Linux** — использует AppArmor для обеспечения безопасности.
5. **Linux Mint** — основан на Ubuntu и поддерживает AppArmor.

## Важно помнить

Изменение параметра `kernel.apparmor_restrict_unprivileged_userns` может повлиять на безопасность системы. Прежде чем применять такие изменения, убедитесь, что вы понимаете потенциальные риски и последствия для вашей системы.

## Заключение

Мы рассмотрели, как изменить параметр `kernel.apparmor_restrict_unprivileged_userns` с помощью `sysctl` и сделать изменения постоянными. Будьте осторожны при изменении системных параметров и всегда учитывайте возможные последствия для безопасности.

## Дополнительные материалы

- [Документация по AppArmor](https://wiki.ubuntu.com/AppArmor)
- [Документация по sysctl на kernel.org](https://www.kernel.org/doc/Documentation/sysctl/)
